# Веб-приложение для менеджеров по работе с клиентами банка
---

## Обзор  

Данное веб-приложение предназначено для сотрудников банка, ведущих непосредственную работу с клиентами. С его помощью
сотрудники могут оказывать следующие услуги клиентам:
- Регистрация новых клиентов в банке;
- Изменение персональных данных клиентов;
- Открытие новых банковских счетов для клиентов;
- Пополнение банковских счетов клиентов;
- Снятие денег с банковских счетов клиентов;
- Перевод денег между счетами клиента или на счёт другого клиента;
- Закрытие существующих банковских счетов клиентов;
- Прекращение клиентских отношений с банком.

Веб-приложение доступно локально по следующему URL: http://localhost:8080/api/clients.  

## Стек технологий  

В разработке приложения используются следующие технологии:
- Java 17
- Spring Boot 3.1.5:
  - Spring Boot Starter Data JPA
  - Spring Boot Starter Thymeleaf
  - Spring Boot Starter Validation
  - Spring Boot Starter Web
  - Spring Boot Starter Test
- Apache Maven (сборщик проекта)
- PostgreSQL (реляционная база данных)
- Project Lombok (библиотека для упрощения Java-кода)
- ModelMapper 3.2.0 (библиотека для маппинга объектов)
- HTML (для представления веб-страниц)
- Bootstrap 5.3.2 (CSS и JavaScript библиотека для веб-дизайна)  

## Подключение к базе данных и её ER–модель  

Для настройки подключения к базе данных необходимо указать параметры в файле 
[application.properties](https://github.com/MicCchaelS/bank-web-app/blob/master/src/main/resources/application.properties).  
История изменений базы данных представлена в пакете 
[db.changelog](https://github.com/MicCchaelS/bank-web-app/tree/master/src/main/resources/db.changelog).  
Ниже представлена ER-модель ("сущность-связь") использованной мною базы данных PostgreSQL:  

![database ER model](https://github.com/MicCchaelS/bank-web-app/blob/master/images/database-ER-model.jpg?raw=true)  

## Результаты работы веб-приложения  

### Список клиентов банка  

Главной страницей веб-приложения является список клиентов банка. Эта страница доступна по следующему URL: 
http://localhost:8080/api/clients и представлена следующим образом:  

![clients list](https://github.com/MicCchaelS/bank-web-app/blob/master/images/clients-list.jpg?raw=true)  

На этой странице отображаются все клиенты банка. Для удобного поиска и фильтрации клиентов по различным параметрам 
доступен соответствующий раздел "Фильтрация и поиск". Здесь вы можете ввести фамилию, имя, отчество или серию и номер 
паспорта, в зависимости от того, какого клиента вы ищете. Пример поиска клиента по серии и номеру паспорта выглядит 
следующим образом:  

![client search](https://github.com/MicCchaelS/bank-web-app/blob/master/images/client-search.jpg?raw=true)  

<details>
  <summary>Правила валидации при фильтрации и поиске:</summary>

- По фамилии:
  - Необязательное поле;
  - От 1 до 35 символов, только русские буквы, заглавная буква только первая (Пример: "Иванов").
- По имени:
  - Необязательное поле;
  - От 1 до 35 символов, только русские буквы, заглавная буква только первая (Пример: "Иван").
- По отчеству:
  - Необязательное поле;
  - От 1 до 35 символов, только русские буквы, заглавная буква только первая (Пример: "Иванович").
- По серии и номеру паспорта:
  - Необязательное поле;
  - Только цифры;
  - Только по серии ("11 22"), по номеру ("333444") или по серии и номеру ("11 22 333444").

</details>

Если список клиентов пуст, то страница будет выглядеть следующим образом:

![empty clients list](https://github.com/MicCchaelS/bank-web-app/blob/master/images/empty-clients-list.jpg?raw=true)  

Кроме того, на эту главную страницу можно перейти, нажав кнопку "Список клиентов" в навигационной панели на любой 
другой странице.  

### Добавление нового клиента  

Чтобы добавить нового клиента, нажмите на кнопку "Добавить клиента" на странице списка клиентов. После этого произойдет
переход по следующему URL: http://localhost:8080/api/clients/new, и откроется страница добавления нового клиента:  

![new client addition 1](https://github.com/MicCchaelS/bank-web-app/blob/master/images/new-client-addition-1.jpg?raw=true)
![new client addition 2](https://github.com/MicCchaelS/bank-web-app/blob/master/images/new-client-addition-2.jpg?raw=true)  

Для добавления клиента введите основную информацию о клиенте, а также его паспортные данные, после чего нажмите кнопку 
"Создать". Если данные введены корректно, будет совершён переход на страницу с информацией о клиенте.

<details>
  <summary>Правила валидации данных клиента:</summary>

1. Основные данные:
   - Фамилия:
     - Обязательное поле;
     - Только русские буквы, от 2 до 35 символов, первая буква заглавная (Пример: "Иванов").
   - Имя:
     - Обязательное поле;
     - Только русские буквы, от 2 до 35 символов, первая буква заглавная (Пример: "Иван").
   - Отчество:
     - Необязательное поле (оставляется пустым или заполняется при его наличии);
     - При заполнении только русские буквы, от 2 до 35 символов, первая буква заглавная (Пример: "Иванович").
   - Дата рождения:
     - Обязательное поле;
     - Должна быть в прошлом;
     - Формат ввода "ДД.ММ.ГГГГ" (Пример: "01.01.2009");
     - Возраст от 14 лет.
   - СНИЛС:
     - Необязательное поле (оставляется пустым или заполняется при необходимости);
     - При заполнении формат ввода "XXX-XXX-XXX XX", где X - цифра от 0 до 9 (Пример: "111-111-111 11");
     - При заполнении уникальный (отсутствие клиента с этим СНИЛС).
   - Номер телефона:
     - Необязательное поле (оставляется пустым или заполняется при необходимости);
     - При заполнении формат ввода "+XXXXXXXXXXX", где X - цифра от 0 до 9 (Пример: "+79876543210");
     - При заполнении уникальный (отсутствие клиента с этим номером телефона).

2. Паспортные данные:
   - Гражданство:
     - Обязательное поле;
     - Выбирается из раскрывающегося списка.
   - Серия и номер паспорта:
     - Обязательное поле;
     - Формат ввода "XX XX XXXXXX", где X - цифра от 0 до 9 (Пример: "11 22 333444");
     - Уникальные (отсутствие клиента с этими серией и номером паспорта).
   - Пол:
     - Обязательное поле;
     - Выбирается из раскрывающегося списка (мужской или женский).
   - Место рождения:
     - Обязательное поле;
     - От 3 до 255 символов.
   - Дата выдачи:
     - Обязательное поле;
     - Должна быть в прошлом;
     - Формат ввода "ДД.ММ.ГГГГ" (Пример: "01.01.2023").
   - Код подразделения:
     - Обязательное поле;
     - Формат ввода "XXX-XXX", где X - цифра от 0 до 9 (Пример: "123-456").
   - Кем выдан:
     - Обязательное поле;
     - От 2 до 255 символов.
   - Адрес регистрации:
     - Обязательное поле;
     - От 4 до 255 символов.

</details>

В случае нарушения любого из этих правил клиент добавлен не будет. Будут выведены соответствующие сообщения об ошибках 
при их наличии. Если данные введены корректно, произойдет перенаправление на страницу с новосозданным клиентом.  

### Информация о клиенте  

Для просмотра подробной информации о клиенте нажмите кнопку "Подробнее" на странице списка клиентов в строке таблицы, 
соответствующей этому клиенту. Затем произойдет переход по следующему URL: http://localhost:8080/api/clients/{id} (где 
{id} - уникальный числовой идентификатор клиента). Также на эту страницу можно попасть после создания клиента. Внизу 
страницы находятся кнопки для перехода к банковским счетам клиента, редактирования информации о клиенте и удаления 
клиента, если этот клиент больше не хочет быть клиентом банка. Сама страница выглядит следующим образом:  

![client 1](https://github.com/MicCchaelS/bank-web-app/blob/master/images/client-1.jpg?raw=true)
![client 2](https://github.com/MicCchaelS/bank-web-app/blob/master/images/client-2.jpg?raw=true)  

### Редактирование данных клиента  

Для редактирования данных клиента нажмите кнопку "Редактировать данные" на странице с информацией о клиенте. Затем 
произойдет переход по следующему URL: http://localhost:8080/api/clients/{id}/edit на страницу редактирования данных 
клиента:  

![client editing 1](https://github.com/MicCchaelS/bank-web-app/blob/master/images/client-editing-1.jpg?raw=true)
![client editing 2](https://github.com/MicCchaelS/bank-web-app/blob/master/images/client-editing-2.jpg?raw=true)  

После нажатия кнопки "Сохранить изменения", если данные введены корректно, произойдет перенаправление на страницу с 
обновлённой информацией о клиенте. В случае некорректного ввода данных действуют те же правила валидации данных, что и 
для добавления нового клиента с отображением соответствующих ошибок.  

### Удаление клиента  

Для удаления клиента нажмите кнопку "Удалить клиента" на странице с информацией о клиенте. Затем откроется 
предупреждающее окно:  

![client deletion](https://github.com/MicCchaelS/bank-web-app/blob/master/images/client-deletion.jpg?raw=true)  

Если Вы уверены и нажмёте кнопку "Удалить" в этом окне, вся информация о клиенте и его банковских счетах будет 
удалена, после чего откроется страница со списком клиентов. Операция будет выполнена только в том случае, если клиент 
предварительно закрыл все свои банковские счета. В противном случае удаление не произойдет, и будет выведено сообщение 
об ошибке:  

![client deletion exception](https://github.com/MicCchaelS/bank-web-app/blob/master/images/client-deletion-exception.jpg?raw=true)  

### Банковские счета клиента  

Для просмотра списка банковских счетов клиента нажмите кнопку "Банковские счета клиента" на странице с информацией о 
клиенте. Затем произойдет переход по следующему URL: http://localhost:8080/api/clients/{id}/accounts, и откроется 
страница со списком банковских счетов клиента:  

![bank accounts list](https://github.com/MicCchaelS/bank-web-app/blob/master/images/bank-accounts-list.jpg?raw=true)  

Если список банковских счетов клиента пуст, страница будет выглядеть следующим образом:  

![empty bank accounts list](https://github.com/MicCchaelS/bank-web-app/blob/master/images/empty-bank-accounts-list.jpg?raw=true)  

### Открытия нового банковского счёта  

Для открытия нового банковского счёта нажмите кнопку "Создать новый счёт" на странице списка банковских счетов. Это 
автоматически генерирует уникальный номер счёта и происходит переход на страницу новосозданного счёта по следующему 
URL: http://localhost:8080/api/clients/{clientId}/accounts/{accountId} (где {accountId} - уникальный числовой 
идентификатор банковского счёта). Для одного клиента допускается не более 10 одновременно открытых банковских счетов. 
При нарушении этого правила и попытке создать новый счёт откроется страница с соответствующим сообщением об ошибке:  

![bank account creation exception](https://github.com/MicCchaelS/bank-web-app/blob/master/images/bank-account-creation-exception.jpg?raw=true)  

### Банковский счёт клиента  

Для открытия страницы с информацией о конкретном банковском счёте нажмите кнопку "Подробнее" на странице списка 
банковских счетов клиента в строке таблицы, соответствующей этому клиенту. После нажатия происходит перенаправление по 
следующему URL: http://localhost:8080/api/clients/{clientId}/accounts/{accountId}, и страница отображает следующее:  

![bank account](https://github.com/MicCchaelS/bank-web-app/blob/master/images/bank-account.jpg?raw=true)  

Также на эту страницу происходит перенаправление при создании нового банковского счёта. Здесь есть кнопки для 
перехода к пополнению счёта, снятию денег со счёта и закрытию счёта.  

### Пополнение банковского счёта  

Для пополнения банковского счёта нажмите кнопку "Пополнить счёт" на странице этого счёта. После этого произойдёт 
перенаправление по следующему URL: http://localhost:8080/api/clients/{clientId}/accounts/{accountId}/top-up, и страница
будет иметь следующий вид:  

![bank account replenishment](https://github.com/MicCchaelS/bank-web-app/blob/master/images/bank-account-replenishment.jpg?raw=true)  

Здесь Вам нужно указать сумму, которую клиенту требуется зачислить на баланс счёта, после чего нажать кнопку 
"Пополнить", чтобы выполнить операцию. Если сумма введена корректно, будет произведено её зачисление на баланс счёта 
клиента и перенаправление на страницу этого счёта.

<details>
  <summary>Правила валидации суммы пополнения:</summary>

- Обязательное поле;
- Только цифры, если указывается целое значение. Максимум 9 цифр;
- Если сумма имеет десятичную часть, то она должна быть указана с одним десятичным разделителем (точкой ".") для
  обозначения копеек. После точки допускается наличие не более 2 цифр. Тогда максимум 11 цифр (9 до точки и 2 после);
- Положительная и неотрицательная с допустимым диапазоном от 10 ₽ до 500 000 000 ₽;
- После выполнения операции новый баланс счёта не должен превышать максимально допустимый лимит в 1 000 000 000 ₽.

</details>

В случае нарушения любого из этих правил операция не будет выполнена, и будет выведено соответствующее сообщение об
ошибке.  

### Снятие денег с банковского счёта  

Для снятия денег с банковского счёта нажмите кнопку "Снять деньги со счёта" на странице этого счёта. После этого 
произойдёт перенаправление по следующему URL: 
http://localhost:8080/api/clients/{clientId}/accounts/{accountId}/withdraw. Эта страница откроется и будет отображать 
следующее:  

![bank account withdrawing money](https://github.com/MicCchaelS/bank-web-app/blob/master/images/bank-account-withdrawing-money.jpg?raw=true)  

Здесь Вам нужно указать сумму, которую клиенту требуется снять со счёта, и нажать кнопку "Снять", чтобы выполнить 
операцию. Если сумма введена корректно, будет произведено её списание с баланса счёта клиента и перенаправление на 
страницу этого счёта.

<details>
  <summary>Правила валидации суммы списания:</summary>

- Обязательное поле;
- Только цифры, если указывается целое значение. Максимум 9 цифр;
- Если сумма имеет десятичную часть, то она должна быть указана с одним десятичным разделителем (точкой ".") для
  обозначения копеек. После точки допускается наличие не более 2 цифр. Тогда максимум 11 цифр (9 до точки и 2 после);
- Положительная и неотрицательная с допустимым диапазоном от 1 ₽ до 500 000 000 ₽;
- Не должна превышать текущий баланс счёта.

</details>

В случае нарушения любого из этих правил операция не будет выполнена, и будет выведено соответствующее сообщение об 
ошибке.  

### Перевод между счетами банка  

Для перевода денег между счетами клиента или на счёт другому клиенту нажмите кнопку "Перевести деньги на другой счёт" 
на странице этого счёта. После этого произойдет перенаправление по следующему URL: 
http://localhost:8080/api/clients/{clientId}/accounts/{accountId}/transfer. Страница откроется и будет иметь следующий 
вид:  

![transfer between bank accounts](https://github.com/MicCchaelS/bank-web-app/blob/master/images/transfer-between-bank-accounts.jpg?raw=true)  

Здесь Вам нужно указать номер счёта получателя и сумму перевода, которые озвучит клиент. Затем требуется нажать кнопку 
"Перевести", чтобы выполнить операцию. Если номер счёта получателя и сумма перевода введены корректно, будет произведено 
её зачисление на баланс указанного счёта клиента и перенаправление на страницу счёта отправителя.

<details>
  <summary>Правила валидации данных:</summary>

- Номер счёта для перевода:
  - Обязательное поле;
  - Только 20 цифр без каких-либо символов;
  - Существование банковского счёта клиента с указанным номером в этом банке.
- Сумма перевода:
  - Обязательное поле;
  - Только цифры, если указывается целое значение. Максимум 9 цифр;
  - Если сумма имеет десятичную часть, то она должна быть указана с одним десятичным разделителем (точкой ".") для 
    обозначения копеек. После точки допускается наличие не более 2 цифр. Тогда максимум 11 цифр (9 до точки и 2 после);
  - Положительная и неотрицательная с допустимым диапазоном от 1 ₽ до 500 000 000 ₽;
  - Не должна превышать текущий баланс счёта отправителя.
  - После выполнения операции новый баланс счёта получателя не должен превышать максимально допустимый лимит в 
    1 000 000 000 ₽.

</details>

В случае нарушения любого из этих правил операция не будет выполнена. Будут выведены соответствующие сообщения об 
ошибках при их наличии.  

### Закрытие банковского счёта  

Для закрытия банковского счёта нажмите кнопку "Закрыть счёт" на странице этого счёта. После этого откроется следующее 
предупреждающее окно:  

![bank account closing](https://github.com/MicCchaelS/bank-web-app/blob/master/images/bank-account-closing.jpg?raw=true)  

Если Вы уверены и кнопка была нажата не случайно, то далее в этом окне следует нажать на кнопку "Закрыть счёт". Счёт 
будет закрыт, и откроется страница со списком банковских счетов. Операция закрытия счёта будет выполнена только в том 
случае, если клиент перед этим снял все деньги с этого счёта. В противном случае операция не выполнится, и будет выведено 
соответствующее сообщение об ошибке:  

![bank account closing exception](https://github.com/MicCchaelS/bank-web-app/blob/master/images/bank-account-closing-exception.jpg?raw=true)  

Если счёт был успешно закрыт, то при открытии страницы с информацией о нём кнопки с различными операциями будут 
недоступны, и страница будет иметь следующий вид:  

![closed bank account](https://github.com/MicCchaelS/bank-web-app/blob/master/images/closed-bank-account.jpg?raw=true)  

### История операций на банковском счёте  

Все операции, выполняемые Вами на любом банковском счёте, сохраняются в базу данных в соответствующую таблицу. В ней 
указываются:
1. Уникальный числовой идентификатор операции;
2. Тип операции (создание счёта, пополнение, списание, отправление перевода, получение перевода или закрытие
   счёта);
3. Сумма (при совершённом пополнении, списании или переводе. В остальных случаях записывается null);
4. Остаток на счёте после выполнения операции;
5. Дата и время выполнения операции;
6. Числовой идентификатор банковского счёта, которому принадлежит та или иная операция;
7. Числовой идентификатор банковского счёта отправителя перевода (при совершённом переводе. В остальных случаях 
   записывается null);
8. Числовой идентификатор банковского счёта получателя перевода (при совершённом переводе. В остальных случаях 
   записывается null).

Эта таблица выглядит следующим образом:  

![bank account actions history](https://github.com/MicCchaelS/bank-web-app/blob/master/images/bank-account-actions-history.jpg?raw=true)  

### Пример валидация введённых данных  

На каждой странице, где Вы можете вводить какие-либо данные, эти данные тщательно валидируются. В случае любого неверно 
введённого значения возвращается сообщение с указанием того, что и где следует исправить. Вот пример некорректно 
введённых данных при добавлении клиента и соответствующих сообщений об ошибках:  

![new client validation 1](https://github.com/MicCchaelS/bank-web-app/blob/master/images/new-client-validation-1.jpg?raw=true)
![new client validation 2](https://github.com/MicCchaelS/bank-web-app/blob/master/images/new-client-validation-2.jpg?raw=true)  

Большинство правил валидации данных были описаны выше под теми пунктами, в которых отображаются пользовательские 
страницы.  

### Ошибка "Ресурс не найден"  

Если произойдет какая-то ошибка, и будет указан несуществующий идентификатор клиента или банковского счёта, или же Вы 
сами укажете его в URL, то откроется страница с соответствующим сообщением об ошибке. Пример попытки открыть 
несуществующего клиента:  

![client not found exception](https://github.com/MicCchaelS/bank-web-app/blob/master/images/client-not-found-exception.jpg?raw=true)  

Все подобные ошибки (кастомные исключения) отлавливаются, выбрасываются, отображая пользователю соответствующее 
сообщение, и логируются в приложении.  
